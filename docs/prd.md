# My School Ride MVP 需求文档
\n## 1. 网站名称
My School Ride - 校车追踪管理系统（MVP版）

## 2. 网站描述
一个面向学校的校车管理平台，提供统一登录入口，支持管理员、司机、学生、家长四种角色。核心功能包括：管理员对车辆、司机、学生、家长的全面管理；司机实时GPS位置上报；学生和家长实时查看校车位置。
\n## 3. 核心功能模块

### 3.1 统一登录系统
- **统一登录入口**：所有用户类型（管理员、司机、学生、家长）通过同一登录页面访问系统
- **角色选择机制**：登录页面提供下拉菜单或按钮组，用户需先选择角色后输入凭证
- **角色验证**：系统根据选中角色验证对应数据库表中的用户名和密码
- **管理员专用路由**：访问 `/adminherelogin` 自动跳转至登录页并预选管理员角色
- **预配置超级管理员账号**：
  - 用户名：`chandrasekharadmin`
  - 密码：`chandrasekharadmin1023@@`
- JWT身份认证和会话管理

### 3.2 管理员模块
- **车辆管理（CRUD）**：
  - 添加车辆：车辆ID、车牌号、型号、载客量\n  - 查看车辆列表：支持搜索和筛选
  - 编辑车辆信息\n  - 停用/删除车辆记录
\n- **司机管理（CRUD）**：
  - 添加司机：姓名、联系方式、驾照号、分配车辆
  - 查看司机列表\n  - 编辑司机信息
  - 停用/删除司机账号

- **学生管理（CRUD）**：
  - 添加学生：姓名、学号、年级、接送点坐标、关联家长
  - 查看学生列表
  - 编辑学生信息
  - 停用/删除学生记录

- **家长管理（CRUD）**：
  - 添加家长：姓名、联系方式、关联学生
  - 查看家长列表
  - 编辑家长信息\n  - 停用/删除家长账号
\n### 3.3 司机模块
- **司机仪表盘**：登录后显示当前任务和车辆信息
- **实时追踪功能**：
  - '开始追踪'按钮：启动GPS位置上报
  - GPS数据采集：每10-30秒自动获取设备GPS坐标（经纬度）
  - 位置数据上传：通过API实时提交位置至服务器数据库
  - 后台持续运行：即使应用在后台也保持位置更新
-显示当前速度和行驶状态

### 3.4 学生与家长模块（共享视图）
- **实时地图追踪**：
  - 登录后自动加载地图界面
  - 显示分配给该学生的校车实时位置
  - 车辆标记随GPS数据更新自动移动
  - 显示车辆移动轨迹
- **位置信息展示**：
  - 学生接送点标记\n  - 校车当前位置与接送点距离
  - 预计到达时间（ETA）
-地图自动刷新机制（每10-30秒同步最新位置）

## 4. 技术架构说明

### 4.1 数据库设计
- **独立用户表结构**：
  - `admins` 表：管理员账号信息
  - `drivers` 表：司机账号及详细信息
  - `students` 表：学生档案及接送点坐标
  - `parents` 表：家长账号及关联学生
  - `vehicles` 表：车辆信息及分配状态
  - `gps_locations` 表：司机实时位置记录（driver_id、latitude、longitude、timestamp）
\n### 4.2 后端技术栈
- Node.js + Express框架
- MongoDB数据库（支持地理空间索引）
- Mongoose ORM
- JWT身份认证
- RESTful API设计
-实时通信方案：WebSocket 或 Server-Sent Events（SSE）或定时API轮询
\n### 4.3 前端技术栈
**管理后台：**
- React（Vite构建）
- Tailwind CSS
- 表格组件库（用于CRUD操作）
- Axios HTTP客户端
\n**司机/学生/家长端：**
- React Native + Expo（移动应用）
- 地图集成：Google Maps API 或 Leaflet
- 后台定位服务（React Native Background Geolocation）

### 4.4 核心API端点
- `POST /api/auth/login`：统一登录接口（需传递角色参数）
- `POST /api/gps/update`：司机上报GPS位置\n- `GET /api/gps/latest/:driverId`：获取指定司机最新位置
- `GET /api/admin/vehicles`：管理员获取车辆列表
- `POST /api/admin/vehicles`：管理员添加车辆
- `PUT /api/admin/vehicles/:id`：管理员更新车辆
- `DELETE /api/admin/vehicles/:id`：管理员删除车辆
- 类似的CRUD端点适用于drivers、students、parents

## 5. 实时追踪实现方案
- **司机端**：使用设备GPS API获取位置，通过HTTP POST或WebSocket发送至服务器
- **服务器端**：接收位置数据存入数据库，通过WebSocket广播或SSE推送给订阅的客户端
- **学生/家长端**：建立WebSocket连接或定时轮询API，接收最新位置并更新地图标记
-位置数据保留策略：保存最近24小时轨迹用于历史回放

## 6. 安全与性能
- 密码加密存储（bcrypt）
- JWT令牌过期机制
- CORS跨域配置
- 请求限流保护
- GPS数据节流存储（避免数据库过载）
- 地理空间索引优化查询性能

## 7. 网站设计风格
- **主题定位**：现代简洁风格，强调功能性和易用性
- **配色方案**：
  - 主背景：#f8fafc（浅灰白）
  - 卡片背景：#ffffff（纯白）
  - 主题色：#3b82f6（科技蓝）
  - 成功色：#10b981（翠绿）
  - 警告色：#f59e0b（橙黄）
  - 边框色：#e2e8f0（浅灰）
- **视觉细节**：\n  - 圆角：中等圆角（0.5rem）
  - 阴影：轻微卡片阴影
  - 按钮：扁平化设计，悬停时轻微提升效果
  - 地图：清晰的标记图标，车辆标记带方向指示
  - 表格：斑马纹行样式，悬停高亮\n- **布局方式**：
  - 管理后台：侧边栏导航 + 主内容区\n  - 移动端：底部导航栏 + 全屏地图视图
  - 表单：垂直排列，清晰的字段标签
  - 响应式设计，适配桌面和移动设备