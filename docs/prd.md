# My School Ride 企业版需求文档

## 1. 网站名称
My School Ride - 智能校车追踪管理系统

## 2. 网站描述
一个企业级SaaS平台,为学校提供实时校车追踪、学生安全管理、司机调度和家长通知服务。采用服务导向架构(SOA),支持高并发、实时定位和地理围栏功能。
\n## 3. 核心功能模块
\n### 3.1 用户管理系统
- 多角色权限体系:超级管理员、学校管理员、司机、家长\n- 管理员创建用户账号(司机和家长)\n- 用户资料管理:头像、联系方式、通知设置
- JWT身份认证和访问令牌刷新机制

### 3.2 车队管理
- 校车信息管理:车牌号、型号、载客量、IMEI设备号
- 车辆状态追踪:运行中、维护中、已退役
- 司机分配和调度\n- 车辆最后已知位置记录(支持地理空间索引)

### 3.3 路线与站点管理
- 路线规划:路线名称、编码、路径折线
- 站点配置:站点名称、坐标、预计到达时间、停靠顺序
- 学生上下车点分配
\n### 3.4 学生档案管理
- 学生基本信息:姓名、学号、班级\n- 监护人关联(支持多位家长)
- 分配校车和接送点
- 接送点地理坐标设置

### 3.5 实时追踪系统
- WebSocket实时通信(房间隔离机制)
- 司机端GPS位置上报(每3秒)\n- 管理端实时地图显示所有运行车辆
- 车辆标记显示:位置、速度、行驶方向
- 地理围栏触发:当校车接近学生接送点1公里内自动推送通知

### 3.6 行程记录与审计
- 行程会话记录:开始/结束时间、司机、路线\n- GPS轨迹面包屑存储(用于回放)
- 事件日志:到达站点、学生上下车等\n\n### 3.7 数据统计与可视化
- 仪表盘:总车辆数、活跃行程、告警数、维护车辆
- 近期活动记录\n- 每小时活跃车辆趋势图(折线图)
\n### 3.8 移动端功能
**司机端:**
- 后台位置服务(即使应用在后台也持续上报GPS)\n- 一键开始/结束行程
- 实时显示当前速度和下一站点
- 学生考勤:点击标记学生上车状态

**家长端:**
- 多子女账号切换
- 实时地图追踪校车位置
- 显示孩子接送点和校车路线
- 预计到达时间(ETA)提示
- 推送通知:校车接近提醒

## 4. 技术架构说明

### 4.1 后端技术栈
- Node.js + Express框架
- MongoDB Atlas(分片集群)
- Mongoose ORM
- Socket.io实时通信
- Joi数据验证
- Winston日志系统
- Helmet安全防护
- Redis缓存
\n### 4.2 前端技术栈
**管理后台:**
- React(Vite构建)
- Tailwind CSS
- Framer Motion动画
- Headless UI组件
- React Query状态管理
- Mapbox地图集成

**移动应用:**
- React Native\n- Expo框架
- 后台任务管理器
- React Native Maps
\n### 4.3 核心技术特性
- 服务导向架构(SOA)单体仓库
- JWT双令牌认证机制
- 地理空间2dsphere索引
- Haversine距离计算
- WebSocket房间隔离
- 限流保护(15分钟100次请求)
- Docker容器化部署
- CI/CD自动化流水线

## 5. 安全与性能\n- Helmet安全头部防护
- CORS跨域配置
- 密码加密存储
- 全局错误处理中间件
- 未捕获异常处理
- 请求日志记录(Morgan)
- 位置数据节流保存(10秒间隔)

## 6. 部署方案
- Docker多阶段构建
- Docker Compose编排(后端、前端、MongoDB、Redis)
- GitHub Actions CI/CD\n- VPS自动部署
- Nginx反向代理
\n## 7. 网站设计风格
- **主题定位**:Cyber-Dark(赛博暗黑风格)
- **配色方案**:\n  - 主背景:#0f172a(深石墨蓝)
  - 卡片背景:#1e293b(深灰蓝)
  - 主题色:#10b981(霓虹翠绿)
  - 危险色:#ef4444(警示红)
  - 边框色:#475569(石板灰)
- **视觉细节**:
  - 圆角:xl级别(0.75rem)
  - 阴影:多层次阴影效果
  - 边框:细线边框配合深色调
  - 动画:Framer Motion流畅过渡动画
  - 地图:Mapbox深色模式(dark-v10)
  - 车辆标记:自定义SVG图标,根据行驶方向旋转,移动时带脉冲动画效果
- **布局方式**:
  - 固定侧边栏导航(深色渐变)
  - 顶部搜索栏+通知+用户下拉菜单
  - 卡片式网格布局
  - 全屏地图视图
  - 移动端底部抽屉式信息卡片